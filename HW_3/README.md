# Ecommerce Data Analysis Project

## Описание задания

Домашняя работа №3

1. Выберите любой открытый датасет и скачайте открытый датасет, соответствующий вашим интересам или области обучения.
2. Создайте новую базу данных в системе управления базами данных (например, SQLite, PostgreSQL).
3. Создайте таблицу (или несколько таблиц) в базе данных с различными типами данных (INTEGER, TEXT, DATE), которые требуются для вашего датасета. Импортируйте данные из датасета в созданные таблицы.
4. Напишите несколько SQL-запросов для извлечения данных из таблиц базы данных. Используйте условия фильтрации (например, WHERE) для получения нужных данных.
5. Напишите SQL-запросы, использующие агрегатные функции (SUM, AVG, COUNT) для выполнения расчетов по данным таблицы.
6. Визуализируйте данные. Используйте библиотеки Python, такие как Matplotlib или Seaborn, для визуализации данных, извлеченных из базы данных. Постройте графики или диаграммы, которые помогут проанализировать и понять данные.

## Цель проекта

1. Создать базу данных для хранения данных о покупках.
2. Загрузить данные из CSV-файла в базу данных.
3. Выполнить анализ данных с помощью SQL-запросов.
4. Визуализировать результаты анализа.

## Структура проекта

Проект состоит из следующих файлов и модулей:

- HW_3/
    1. Data/
        - ecommerce.sql
    2. Modules/
        - db_utils.py
        - get_data_from_db.py
        - visualization.py
    - main.ipynb

## Файлы с данными

Данные для анализа хранятся в CSV-файле в подкаталоге `Data`. Файл содержит следующие поля:

- `Customer ID`: Уникальный идентификатор клиента; целое число.
- `Purchase Date`: Дата покупки; дата.
- `Product Category`: Категория или тип купленного продукта; текст.
- `Product Price`: Цена купленного продукта; целое число.
- `Quantity`: Количество купленного продукта; целое число.
- `Total Purchase Amount`: Общая сумма, потраченная клиентом в каждой транзакции (Total Purchase Amount не равна Product Price * Quantity по какой-то причине); целое число.
- `Payment Method`: Метод оплаты, использованный клиентом (например, кредитная карта, PayPal); текст.
- `Customer Age`: Возраст клиента (сгенерирован с помощью Faker); целое число.
- `Returns`: Возвращал ли клиент какие-либо продукты из заказа (бинарное значение: 0 - нет возврата, 1 - возврат); целое число.
- `Customer Name`: Имя клиента (сгенерировано с помощью Faker); текст.
- `Age`: Возраст клиента (похоже, дублирует Customer Age); целое число.
- `Gender`: Пол клиента (сгенерирован с помощью Faker); текст.
- `Churn`: Бинарное значение, указывающее, ушел ли клиент (0 - остался, 1 - ушел); целое число.

Датасет взят с [Kaggle](https://www.kaggle.com/datasets/shriyashjagtap/e-commerce-customer-for-behavior-analysis) с предварительной ручной обработкой (удалена строка заголовков, столбец Returns из формата "1.0" приведен к целочисленному для корректной подгрузки в поле типа integer).

## Модули и основные функции

### `main.ipynb`

- Выполнение анализа данных и визуализация результатов с использованием функций из модулей `db_utils.py`, `get_data_from_db.py` и `visualization.py`.

### `db_utils.py`

- `load_env(env_path=None)`: Функция для загрузки переменных окружения.
- `connect_to_db()`: Функция для подключения к базе данных PostgreSQL.
- `execute_query(query)`: Функция для выполнения SQL-запросов.
- `create_and_load_table(csv_file_path)`: Функция для создания таблицы и загрузки данных из CSV.

### `get_data_from_db.py`

- `get_data_summary()`: Функция для получения сводки данных из базы данных.

### `visualization.py`

- `plot_price_distribution_by_category()`: Функция для визуализации распределения цен товаров по категориям.
- `plot_scatter_by_category()`: Функция для визуализации диаграмм рассеивания по категориям товаров.
- `plot_scatter_by_gender()`: Функция для визуализации распределения покупок в зависимости от пола.